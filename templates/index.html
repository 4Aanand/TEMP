<!DOCTYPE html>
<html>
<head>
    <title>Predictive Maintenance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>ðŸ›  Predictive Maintenance Dashboard</h1>

        <!-- Machine 1 -->
        <h2>Machine Name: Compressor A | ID: MCH-001</h2>
        <canvas id="chart1" width="600" height="300"></canvas>
        <div id="status1">Status: Loading...</div>

        <!-- Machine 2 -->
        <h2>Machine Name: Pump B | ID: MCH-002</h2>
        <canvas id="chart2" width="600" height="300"></canvas>
        <div id="status2">Status: Loading...</div>

        <!-- Repair Scheduling Form -->
        <form action="/schedule" method="post">
            <input type="datetime-local" name="repair_time" required>
            <button type="submit">Schedule Repair</button>
        </form>

        {% if message %}
            <div class="confirmation">{{ message }}</div>
        {% endif %}
    </div>

    <script>
        const chart1 = new Chart(document.getElementById('chart1').getContext('2d'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'Temperature (Â°F)', data: [], borderColor: 'red', fill: false },
                    { label: 'Vibration (g)', data: [], borderColor: 'blue', fill: false }
                ]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } }
            }
        });

        const chart2 = new Chart(document.getElementById('chart2').getContext('2d'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'Temperature (Â°F)', data: [], borderColor: 'green', fill: false },
                    { label: 'Vibration (g)', data: [], borderColor: 'orange', fill: false }
                ]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } }
            }
        });

        async function fetchData() {
            const res1 = await fetch('/data?machine_id=MCH-001');
            const data1 = await res1.json();
            chart1.data.labels.push(new Date().toLocaleTimeString());
            chart1.data.datasets[0].data.push(data1.temperature);
            chart1.data.datasets[1].data.push(data1.vibration);
            chart1.update();
            document.getElementById('status1').innerText = `Status: ${data1.status}`;

            const res2 = await fetch('/data?machine_id=MCH-002');
            const data2 = await res2.json();
            chart2.data.labels.push(new Date().toLocaleTimeString());
            chart2.data.datasets[0].data.push(data2.temperature);
            chart2.data.datasets[1].data.push(data2.vibration);
            chart2.update();
            document.getElementById('status2').innerText = `Status: ${data2.status}`;
        }

        setInterval(fetchData, 3000);
    </script>
</body>
</html>